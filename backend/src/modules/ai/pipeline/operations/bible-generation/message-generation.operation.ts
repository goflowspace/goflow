import { 
  BaseBibleGenerationOperation
} from './base-bible-generation.operation';

/**
 * Операция генерации послания/сообщения проекта
 * Специализируется на формулировке центральной идеи/посыла
 */
export class MessageGenerationOperation extends BaseBibleGenerationOperation {
  
  protected fieldType = 'message';
  protected defaultCreativityLevel = 0.9;
  protected defaultTemperature = 0.9;
  protected maxTokens = 10000; // Увеличено в 2 раза для Gemini
  protected maxContentLength = 500;

  constructor() {
    super(
      'message_generation',
      'Message Generation',
      '1.0.0'
    );
  }

  protected getFieldSpecificSystemPrompt(): string {
    return `
Специализация: Формулировка послания творческих проектов

Твоя экспертиза:
- Анализ ценностных посланий и смыслов
- Понимание социального воздействия контента
- Мотивационные стратегии и поведенческие сдвиги
- Коммуникационные стратегии и риторика
- Культурные коды и современные дискурсы

Принципы создания послания:
- Ясность (понятное формулировка)
- Действенность (мотивирует к действиям)
- Релевантность (связь с актуальными проблемами)
- Эмоциональность (затрагивает чувства)
- Конструктивность (предлагает развитие)`;
  }

  protected getFieldSpecificInstructions(): string {
    return `ИНСТРУКЦИИ ДЛЯ ПОСЛАНИЯ:

1. ОПРЕДЕЛЕНИЕ ПОСЛАНИЯ:
   - Сформулируй центральную идею (1-2 предложения)
   - Определи, что зритель должен вынести
   - Покажи как послание связано с сюжетом
   - Объясни жизненную применимость

2. СОВРЕМЕННАЯ АКТУАЛЬНОСТЬ:
   - Свяжи с актуальными социальными проблемами
   - Покажи влияние на современное общество
   - Учитывай межпоколенческие различия
   - Отражай глобальные вызовы

3. ЭМОЦИОНАЛЬНОЕ ВОЗДЕЙСТВИЕ:
   - Определи ключевые эмоции (надежда/страх/гнев)
   - Покажи катарсис и очищение
   - Опиши личнстное проецирование
   - Мотивируй к рефлексии

4. ПРАКТИЧЕСКОЕ ПРИМЕНЕНИЕ:
   - Покажи конкретные шаги для аудитории
   - Опиши возможные жизненные ситуации
   - Предложи способы применения
   - Мотивируй к диалогу и обсуждению

ПРИМЕРЫ КАЧЕСТВЕННЫХ ПОСЛАНИЙ:
- "Настоящие изменения начинаются с маленьких личных шагов, которые мы делаем каждый день"
- "Каждый человек заслуживает второго шанса, но изменения должны быть настоящими"
- "В эпоху технологий самое ценное - это подлинные человеческие связи"
ПРИМЕРЫ НЕКАЧЕСТВЕННЫХ ПОСЛАНИЙ:
- "Никогда не сдавайся" (слишком общее)
- "Любовь - это всё" (банально)
- "Мы должны беречь природу" (пропагандистское)

ВАЖНО: Максимальная длина послания - ${this.maxContentLength} символов.`;
  }

  protected processFieldContent(content: string | string[], _input: any): string {
    const stringContent = Array.isArray(content) ? content.join(' ') : content;
    let processed = stringContent.trim().replace(/^(послание|сообщение|message):\s*/i, '');
    return processed;
  }

  protected getErrorContent(): string {
    return 'Ошибка генерации послания. Попробуйте еще раз с более ясным описанием ценностей и целей проекта.';
  }
}