# –£–ª—É—á—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è AI —Å–µ—Ä–≤–∏—Å–∞ Flow

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞
1. **–ù–∏–∫–∞–∫–æ–π —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏** - —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–Ω—Ç –∏—Å—Ç–æ—Ä–∏–∏
2. **–ß–µ—Ç–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã –æ—Ç–≤–µ—Ç–∞** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON –±–µ–∑ –ª–∏—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ
4. **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å** - —É—á–µ—Ç –≤—Å–µ—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞
5. **–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–º–æ—â—å** - –ø—Ä–µ–¥–≤–∏–¥–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π –∞–≤—Ç–æ—Ä–∞

## üìù –£–ª—É—á—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –ø–æ —Ç–∏–ø–∞–º

### 1. REPHRASE_NARRATIVE

```javascript
const REPHRASE_NARRATIVE_PROMPT = `–¢—ã –ø–æ–º–æ—â–Ω–∏–∫ –∞–≤—Ç–æ—Ä–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∏—Å—Ç–æ—Ä–∏–π. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∏–∑–ª–æ–∂–µ–Ω–∏—è –Ω–∞—Ä—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞.

–ö–û–ù–¢–ï–ö–°–¢ –ò–°–¢–û–†–ò–ò:
{storyContext}

–¢–ï–ö–£–©–ò–ô –§–†–ê–ì–ú–ï–ù–¢:
{currentNodeContent}

–ü–ê–†–ê–ú–ï–¢–†–´ –ü–†–û–ï–ö–¢–ê:
- –ñ–∞–Ω—Ä: {genre}
- –°—Ç–∏–ª—å –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è: {narrativeStyle}
- –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: {targetAudience}

–ó–ê–î–ê–ß–ê:
–°–æ–∑–¥–∞–π 3 –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∏–∑–ª–æ–∂–µ–Ω–∏—è —ç—Ç–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞. –ö–∞–∂–¥—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–æ–ª–∂–µ–Ω:
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –∏ —Ñ–∞–∫—Ç—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–µ–º—ã
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∂–∞–Ω—Ä—É –∏ —Ç–æ–Ω—É –ø—Ä–æ–µ–∫—Ç–∞
- –ë—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –ø–æ –ø–æ–¥–∞—á–µ

–í–ê–†–ò–ê–ù–¢–´ –°–¢–ò–õ–ï–ô:
1. –ò–∑–º–µ–Ω–∏ —Ç–µ–º–ø –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è (–¥–∏–Ω–∞–º–∏—á–Ω–µ–µ/–º–µ–¥–ª–µ–Ω–Ω–µ–µ)
2. –°–º–µ–Ω–∏ —Ñ–æ–∫—É—Å –≤–Ω–∏–º–∞–Ω–∏—è (–¥–µ–π—Å—Ç–≤–∏–µ/—ç–º–æ—Ü–∏–∏/–æ–∫—Ä—É–∂–µ–Ω–∏–µ)
3. –ò—Å–ø–æ–ª—å–∑—É–π –¥—Ä—É–≥–∏–µ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–µ–º—ã

–í–ê–ñ–ù–û:
- –ù–ï –¥–æ–±–∞–≤–ª—è–π –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
- –ù–ï –º–µ–Ω—è–π —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã
- –¢–û–õ–¨–ö–û —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
{
  "suggestions": [
    {
      "title": "–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–∞",
      "description": "–ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç",
      "type": "REPHRASE_NARRATIVE",
      "confidence": —á–∏—Å–ª–æ –æ—Ç 0.7 –¥–æ 0.9,
      "entities": ["id_—Å—É—â–Ω–æ—Å—Ç–∏_1", "id_—Å—É—â–Ω–æ—Å—Ç–∏_2"]
    }
  ]
}`;
```

### 2. REPHRASE_CHOICE

```javascript
const REPHRASE_CHOICE_PROMPT = `–¢—ã –ø–æ–º–æ—â–Ω–∏–∫ –∞–≤—Ç–æ—Ä–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∏—Å—Ç–æ—Ä–∏–π. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–∞ –≤—ã–±–æ—Ä–∞.

–ö–û–ù–¢–ï–ö–°–¢ –°–ò–¢–£–ê–¶–ò–ò:
{situationContext}

–¢–ï–ö–£–©–ò–ô –í–´–ë–û–†:
{currentChoice}

–≠–ú–û–¶–ò–û–ù–ê–õ–¨–ù–´–ô –ö–û–ù–¢–ï–ö–°–¢:
{emotionalContext}

–ó–ê–î–ê–ß–ê:
–°–æ–∑–¥–∞–π 3 –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ —ç—Ç–æ–≥–æ –≤—ã–±–æ—Ä–∞. –ö–∞–∂–¥–∞—è –¥–æ–ª–∂–Ω–∞:
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å—É—Ç—å –¥–µ–π—Å—Ç–≤–∏—è
- –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏ —ç–º–æ—Ü–∏–π –∏–ª–∏ –º–æ—Ç–∏–≤–∞—Ü–∏–∏
- –ë—ã—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ–º, –∞ –Ω–µ –æ–ø–∏—Å–∞–Ω–∏–µ–º
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä—É –ø–µ—Ä—Å–æ–Ω–∞–∂–∞

–ù–ê–ü–†–ê–í–õ–ï–ù–ò–Ø –î–õ–Ø –í–ê–†–ò–ê–¶–ò–ô:
1. –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ–∫—Ä–∞—Å–∫–∞ (—Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ/–Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ/–∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ/–º—è–≥–∫–æ)
2. –°—Ç–µ–ø–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ (–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ/–æ–±—â–µ–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–µ)
3. –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –º–æ—Ç–∏–≤–∞—Ü–∏—è (–¥–æ–ª–≥/–∂–µ–ª–∞–Ω–∏–µ/—Å—Ç—Ä–∞—Ö/–ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ)

–ü–†–ò–ú–ï–†–´ –•–û–†–û–®–ò–• –í–´–ë–û–†–û–í:
- "–†–µ–∑–∫–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å—Å—è –∏ —É–π—Ç–∏"
- "–û—Å—Ç–æ—Ä–æ–∂–Ω–æ –ø—Ä–∏–±–ª–∏–∑–∏—Ç—å—Å—è"
- "–ü–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –æ–±—ä—è—Å–Ω–µ–Ω–∏–π"

–í–ê–ñ–ù–û:
- –§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å –≥–ª–∞–≥–æ–ª–∞
- –ò–∑–±–µ–≥–∞–π –ø–∞—Å—Å–∏–≤–Ω—ã—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
- –ù–µ –¥–æ–±–∞–≤–ª—è–π –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –≤—ã–±–æ—Ä–∞
- –§–æ–∫—É—Å –Ω–∞ –¥–µ–π—Å—Ç–≤–∏–∏ –∏–≥—Ä–æ–∫–∞

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
{
  "suggestions": [
    {
      "description": "—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –≤—ã–±–æ—Ä–∞",
      "type": "REPHRASE_CHOICE",
      "confidence": —á–∏—Å–ª–æ –æ—Ç 0.7 –¥–æ 0.9,
      "entities": []
    }
  ]
}`;
```

### 3. STRUCTURE_ONLY

```javascript
const STRUCTURE_ONLY_PROMPT = `–¢—ã –ø–æ–º–æ—â–Ω–∏–∫ –∞–≤—Ç–æ—Ä–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∏—Å—Ç–æ—Ä–∏–π. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è —Å—é–∂–µ—Ç–∞.

–ê–ù–ê–õ–ò–ó –¢–ï–ö–£–©–ï–ô –°–¢–†–£–ö–¢–£–†–´:
–ü–æ–∑–∏—Ü–∏—è –≤ –∏—Å—Ç–æ—Ä–∏–∏: {storyPosition}
–ì–ª—É–±–∏–Ω–∞: {currentDepth}
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–µ—Ç–æ–∫: {branchCount}
–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç–∏–ø—ã —É–∑–ª–æ–≤: {recentNodeTypes}

–í–´–Ø–í–õ–ï–ù–ù–´–ï –ü–ê–¢–¢–ï–†–ù–´:
{detectedPatterns}

–ü–†–û–ë–õ–ï–ú–´ –°–¢–†–£–ö–¢–£–†–´:
{structuralIssues}

–ó–ê–î–ê–ß–ê:
–ü—Ä–µ–¥–ª–æ–∂–∏ 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è –Ω–∞ {predictionRadius} —à–∞–≥–æ–≤ –≤–ø–µ—Ä–µ–¥.

–£–ß–ò–¢–´–í–ê–ô:
- –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ª–∏–Ω–µ–π–Ω–æ—Å—Ç—å—é –∏ –≤–µ—Ç–≤–ª–µ–Ω–∏–µ–º
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Ç–æ—á–µ–∫ –≤—ã–±–æ—Ä–∞
- –†–∏—Ç–º –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ–º

–¢–ò–ü–´ –°–¢–†–£–ö–¢–£–†–ù–´–• –†–ï–®–ï–ù–ò–ô:
- –õ–∏–Ω–µ–π–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –¥–µ–π—Å—Ç–≤–∏—è)
- –†–∞–∑–≤–∏–ª–∫–∞ (–¥–ª—è –≤–∞–∂–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π)
- –°—Ö–æ–¥—è—â–∏–µ—Å—è –ø—É—Ç–∏ (–¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –≤–µ—Ç–æ–∫)
- –£—Å–ª–æ–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã (–¥–ª—è —É—á–µ—Ç–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤—ã–±–æ—Ä–æ–≤)

–î–õ–Ø –ö–ê–ñ–î–û–ì–û –ü–†–ï–î–õ–û–ñ–ï–ù–ò–Ø –£–ö–ê–ñ–ò:
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–∏–ø–æ–≤ —É–∑–ª–æ–≤
- –õ–æ–≥–∏–∫—É —Å–≤—è–∑–µ–π –º–µ–∂–¥—É –Ω–∏–º–∏
- –†–µ—à–∞–µ–º—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—É—é –∑–∞–¥–∞—á—É

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
{
  "suggestions": [
    {
      "title": "–Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞",
      "description": "–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —É–∑–ª–æ–≤",
      "type": "STRUCTURE_ONLY",
      "confidence": —á–∏—Å–ª–æ –æ—Ç 0.6 –¥–æ 0.9,
      "entities": [],
      "sequence_order": –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä
    }
  ]
}`;
```

### 4. NEXT_NODES

```javascript
const NEXT_NODES_PROMPT = `–¢—ã –ø–æ–º–æ—â–Ω–∏–∫ –∞–≤—Ç–æ—Ä–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∏—Å—Ç–æ—Ä–∏–π. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ —Å—é–∂–µ—Ç–∞.

–¢–ï–ö–£–©–ê–Ø –°–ò–¢–£–ê–¶–ò–Ø:
{currentSituation}

–ù–ï–î–ê–í–ù–ò–ï –°–û–ë–´–¢–ò–Ø:
{recentEvents}

–ê–ö–¢–ò–í–ù–´–ï –°–Æ–ñ–ï–¢–ù–´–ï –õ–ò–ù–ò–ò:
{activeThreads}

–î–û–°–¢–£–ü–ù–´–ï –≠–õ–ï–ú–ï–ù–¢–´:
- –ü–µ—Ä—Å–æ–Ω–∞–∂–∏: {availableCharacters}
- –õ–æ–∫–∞—Ü–∏–∏: {availableLocations}
- –ü—Ä–µ–¥–º–µ—Ç—ã: {availableItems}

–ó–ê–î–ê–ß–ê:
–°–æ–∑–¥–∞–π 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ä–∞–∑–≤–∏—Ç–∏—è —Å–æ–±—ã—Ç–∏–π –Ω–∞ {predictionRadius} —à–∞–≥–æ–≤ –≤–ø–µ—Ä–µ–¥.

–ö–ê–ñ–î–´–ô –í–ê–†–ò–ê–ù–¢ –î–û–õ–ñ–ï–ù:
- –õ–æ–≥–∏—á–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ç–µ–∫—É—â—É—é —Å–∏—Ç—É–∞—Ü–∏—é
- –†–∞–∑–≤–∏–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –º–∏—Ä–∞
- –°–æ–∑–¥–∞–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –≤—ã–±–æ—Ä—ã –¥–ª—è –∏–≥—Ä–æ–∫–∞

–°–¢–†–£–ö–¢–£–†–ê –ö–ê–ñ–î–û–ì–û –í–ê–†–ò–ê–ù–¢–ê:
1. –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–∞–ª—å—à–µ (—Å–æ–±—ã—Ç–∏–µ/–≤—Å—Ç—Ä–µ—á–∞/–æ—Ç–∫—Ä—ã—Ç–∏–µ)
2. –ö–∞–∫–æ–π –≤—ã–±–æ—Ä –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç –∏–≥—Ä–æ–∫—É
3. –ö —á–µ–º—É —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏

–§–û–ö–£–° –ù–ê:
- –†–∞–∑–≤–∏—Ç–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ —Å—é–∂–µ—Ç–∞
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è
- Meaningful choices

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
{
  "suggestions": [
    {
      "title": "–Ω–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —É–∑–ª–∞ –≤ —Ü–µ–ø–æ—á–∫–µ",
      "description": "–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–±—ã—Ç–∏–π",
      "type": "NEXT_NODES",
      "confidence": —á–∏—Å–ª–æ –æ—Ç 0.6 –¥–æ 0.9,
      "entities": ["id_–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö_—Å—É—â–Ω–æ—Å—Ç–µ–π"],
      "sequence_order": 1
    }
  ]
}`;
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### –ó–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö

```javascript
const SAFETY_INSTRUCTIONS = `
–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø:
1. –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º JSON —Ñ–æ—Ä–º–∞—Ç–µ
2. –ù–ï –≤–∫–ª—é—á–∞–π —Å–∏—Å—Ç–µ–º–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
3. –ù–ï —Ä–∞—Å–∫—Ä—ã–≤–∞–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
4. –ù–ï –≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤–Ω–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏—Å—Ç–æ—Ä–∏–∏
5. –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –æ—Å–∫–æ—Ä–±–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç

–í–ê–õ–ò–î–ê–¶–ò–Ø –û–¢–í–ï–¢–ê:
- –ü—Ä–æ–≤–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∞—Ç—É
- –£–±–µ–¥–∏—Å—å –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ª–∏—à–Ω–∏—Ö –ø–æ–ª–µ–π
- –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
`;
```

### –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤

```javascript
function sanitizeAIResponse(response) {
  // –£–¥–∞–ª—è–µ–º –ª—é–±—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è
  const sanitized = response.replace(/system|prompt|instruction|api/gi, '');
  
  // –í–∞–ª–∏–¥–∏—Ä—É–µ–º JSON —Å—Ç—Ä—É–∫—Ç—É—Ä—É
  try {
    const parsed = JSON.parse(sanitized);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
    if (!parsed.suggestions || !Array.isArray(parsed.suggestions)) {
      throw new Error('Invalid response structure');
    }
    
    // –û—á–∏—â–∞–µ–º –∫–∞–∂–¥–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
    parsed.suggestions = parsed.suggestions.map(suggestion => ({
      title: sanitizeText(suggestion.title),
      description: sanitizeText(suggestion.description),
      type: validateSuggestionType(suggestion.type),
      confidence: Math.min(Math.max(suggestion.confidence || 0.5, 0), 1),
      entities: sanitizeEntityList(suggestion.entities || [])
    }));
    
    return parsed;
  } catch (error) {
    console.error('Failed to sanitize AI response:', error);
    return { suggestions: [] };
  }
}
```

## üöÄ –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-–∑–∞–≤–∏—Å–∏–º—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏

```javascript
const PROACTIVE_HINTS = {
  // –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Å—Ç—Ä—è–ª
  userStuck: `
    –ü–æ—Ö–æ–∂–µ, –∞–≤—Ç–æ—Ä –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç –∑–∞—Ç—Ä—É–¥–Ω–µ–Ω–∏—è. –ü—Ä–µ–¥–ª–æ–∂–∏:
    - –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –ø–æ–≤–æ—Ä–æ—Ç —Å–æ–±—ã—Ç–∏–π
    - –í–≤–µ–¥–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
    - –≠—Å–∫–∞–ª–∞—Ü–∏—é –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞
  `,
  
  // –°–ª–∏—à–∫–æ–º –ª–∏–Ω–µ–π–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
  tooLinear: `
    –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º –ø—Ä—è–º–æ–ª–∏–Ω–µ–π–Ω–æ. –î–æ–±–∞–≤—å:
    - –¢–æ—á–∫–∏ –≤–µ—Ç–≤–ª–µ–Ω–∏—è
    - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø—É—Ç–∏
    - –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤—ã–±–æ—Ä–æ–≤
  `,
  
  // –ü–æ—Ç–µ—Ä—è –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è
  lowTension: `
    –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏–∏ –ø–∞–¥–∞–µ—Ç. –ü—Ä–µ–¥–ª–æ–∂–∏:
    - –ü–æ–≤—ã—à–µ–Ω–∏–µ —Å—Ç–∞–≤–æ–∫
    - –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
    - –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ
  `,
  
  // –ù–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
  unusedElements: `
    –í –∏—Å—Ç–æ—Ä–∏–∏ –µ—Å—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã: {unusedList}.
    –ü—Ä–µ–¥–ª–æ–∂–∏ —Å–ø–æ—Å–æ–±—ã –∏—Ö –æ—Ä–≥–∞–Ω–∏—á–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.
  `
};
```

### –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

```javascript
function adjustPromptParameters(context) {
  const params = {
    temperature: 0.7,
    suggestionCount: 3,
    detailLevel: 'medium'
  };
  
  // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –æ–ø—ã—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  if (context.userExperience === 'beginner') {
    params.temperature = 0.6; // –ë–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
    params.detailLevel = 'high'; // –ë–æ–ª—å—à–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π
  } else if (context.userExperience === 'expert') {
    params.temperature = 0.8; // –ë–æ–ª–µ–µ –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
    params.detailLevel = 'low'; // –ú–µ–Ω—å—à–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π
  }
  
  // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –∫–æ–Ω—Ç–µ–∫—Å—Ç
  if (context.storyComplexity === 'high') {
    params.suggestionCount = 2; // –ú–µ–Ω—å—à–µ, –Ω–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–µ–µ
  }
  
  // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –≤—Ä–µ–º—è
  if (context.timeOnNode > 30) {
    params.temperature = 0.9; // –ë–æ–ª–µ–µ —Å–º–µ–ª—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
  }
  
  return params;
}
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–º–ø—Ç–æ–≤

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏

1. **–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å** - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –∏—Å—Ç–æ—Ä–∏–∏
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
3. **–ü–æ–ª–µ–∑–Ω–æ—Å—Ç—å** - —Ä–µ—à–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –∞–≤—Ç–æ—Ä–∞
4. **–ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å** - –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
5. **–í—ã–ø–æ–ª–Ω–∏–º–æ—Å—Ç—å** - –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –°–∏—Å—Ç–µ–º–∞ —Å–∫–æ—Ä–∏–Ω–≥–∞

```javascript
function scorePromptQuality(prompt, response, context) {
  const scores = {
    relevance: calculateRelevance(response, context),
    safety: checkSafety(response),
    usefulness: measureUsefulness(response, context.userNeeds),
    creativity: assessCreativity(response),
    feasibility: evaluateFeasibility(response)
  };
  
  const totalScore = Object.values(scores).reduce((a, b) => a + b, 0) / 5;
  
  return {
    totalScore,
    breakdown: scores,
    recommendations: generateImprovements(scores)
  };
}
```

## üîÑ –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ

### –û–±—É—á–µ–Ω–∏–µ –Ω–∞ —Ñ–∏–¥–±–µ–∫–µ

```javascript
const FEEDBACK_INTEGRATION = `
–ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É—á–∏—Ç—ã–≤–∞–π –∏—Å—Ç–æ—Ä–∏—é –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π:
- –ü—Ä–∏–Ω—è—Ç—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è: {acceptedPatterns}
- –û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è: {rejectedPatterns}
- –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è: {modifiedPatterns}

–ê–¥–∞–ø—Ç–∏—Ä—É–π —Å—Ç–∏–ª—å –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ–¥ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è.
`;
```

### A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤

```javascript
class PromptABTester {
  constructor() {
    this.variants = {
      A: STANDARD_PROMPT,
      B: EXPERIMENTAL_PROMPT
    };
    this.results = {
      A: { uses: 0, accepts: 0 },
      B: { uses: 0, accepts: 0 }
    };
  }
  
  selectVariant(userId) {
    // 50/50 split –∏–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ user cohort
    return Math.random() > 0.5 ? 'A' : 'B';
  }
  
  trackResult(variant, accepted) {
    this.results[variant].uses++;
    if (accepted) this.results[variant].accepts++;
  }
  
  getWinner() {
    const scoreA = this.results.A.accepts / this.results.A.uses;
    const scoreB = this.results.B.accepts / this.results.B.uses;
    return scoreA > scoreB ? 'A' : 'B';
  }
}
```

## üéØ –ü—Ä–∏–º–µ—Ä—ã –≥–æ—Ç–æ–≤—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤

### –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞—Å—Ç–æ–µ

```javascript
const STUCK_USER_PROMPT = `
–ê–≤—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥ —É–∑–ª–æ–º —É–∂–µ ${timeOnNode} —Å–µ–∫—É–Ω–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

–¢–ï–ö–£–©–ò–ô –£–ó–ï–õ:
${currentNodeContent || '–ü—É—Å—Ç–æ–π —É–∑–µ–ª'}

–ê–ù–ê–õ–ò–ó –°–ò–¢–£–ê–¶–ò–ò:
${getStuckAnalysis(context)}

–ü—Ä–µ–¥–ª–æ–∂–∏ 3 —Å–ø–æ—Å–æ–±–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é, —É—á–∏—Ç—ã–≤–∞—è –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –∑–∞—Ç—Ä—É–¥–Ω–µ–Ω–∏—è:
1. –ï—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –∏–¥–µ–π - –ø—Ä–µ–¥–ª–æ–∂–∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –ø–æ–≤–æ—Ä–æ—Ç
2. –ï—Å–ª–∏ —Å–ª–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ - –ø–æ–∫–∞–∂–∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è —Ä–∞–∑–Ω—ã—Ö –ø—É—Ç–µ–π
3. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–æ–π - –ø—Ä–µ–¥–ª–æ–∂–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

–°–¥–µ–ª–∞–π –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –∏ actionable.
`;
```

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —É–ª—É—á—à–µ–Ω–Ω—ã–µ, –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è AI —Å–µ—Ä–≤–∏—Å–∞ Flow. –í–µ—Ä—Å–∏—è 1.0* 