# Система управления командами

## Обзор

Система управления командами позволяет пользователям создавать команды, приглашать участников, управлять ролями и доступом к проектам. Система спроектирована с учетом принципов SOLID, DRY и KISS.

## Архитектура

### Типы данных (`src/types/team.ts`)

- **Team** - основная модель команды
- **TeamMember** - участник команды с ролью и статусом
- **TeamInvitation** - приглашения в команду
- **TeamProject** - проекты команды с уровнями доступа
- **TeamRole** - роли участников (ADMINISTRATOR, MANAGER, MEMBER, OBSERVER)
- **ProjectRole** - роли в проектах (OWNER, EDITOR, COMMENTER, VIEWER)
- **ProjectAccessLevel** - уровни доступа к проектам (OPEN, RESTRICTED, PRIVATE)

### Права доступа (`src/utils/teamPermissions.ts`)

Модуль содержит функции для работы с ролями и правами:

- `getTeamRolePermissions()` - получение прав доступа для роли
- `canManageMember()` - проверка возможности управления участником
- `getAvailableRoles()` - доступные роли для назначения
- `canAccessProject()` - проверка доступа к проекту
- `canPerformProjectAction()` - проверка возможности выполнения действий

### API (`src/services/api.ts`)

RESTful API для работы с командами:

- **Teams**: `GET /teams`, `POST /teams`, `PUT /teams/:id`, `DELETE /teams/:id`
- **Members**: `GET /teams/:id/members`, `POST /teams/:id/invitations`, `PUT /teams/:id/members/:memberId`
- **Projects**: `GET /teams/:id/projects`, `POST /teams/:id/projects/:projectId/members`

### Store (`src/store/useTeamStore.ts`)

Zustand store для управления состоянием команд:

- Управление командами (создание, обновление, удаление)
- Управление участниками (приглашения, роли, статусы)
- Управление проектами (доступ, участники)
- Вычисляемые данные с правами доступа

## Компоненты

### TeamSwitcher (`src/components/TeamManagement/TeamSwitcher/`)

Переключатель команд с выпадающим меню:
- Отображение текущей команды
- Список всех команд пользователя с ролями
- Кнопка создания новой команды

### CreateTeamModal (`src/components/TeamManagement/CreateTeamModal/`)

Модальное окно создания команды:
- Форма с валидацией
- Настройки доступа по умолчанию
- Настройки приглашений

## Роли и права доступа

### Роли в команде

1. **Администратор** - полный доступ ко всем функциям
2. **Менеджер** - создание проектов, управление участниками
3. **Участник** - редактирование назначенных проектов
4. **Наблюдатель** - только просмотр назначенных проектов

### Уровни доступа к проектам

1. **Открытый** - доступен всем участникам команды
2. **Ограниченный** - доступен только добавленным участникам
3. **Приватный** - доступен только администраторам и владельцу

## Интеграция

Система интегрирована в существующую страницу проектов (`src/app/projects/page.tsx`):
- Переключатель команд в топ-баре
- Модальное окно создания команды
- Переводы на русский язык

## API Endpoints

```
GET    /teams                           # Получить команды пользователя
POST   /teams                           # Создать команду
GET    /teams/:id                       # Получить команду
PUT    /teams/:id                       # Обновить команду
DELETE /teams/:id                       # Удалить команду

GET    /teams/:id/members               # Получить участников
POST   /teams/:id/invitations           # Пригласить участника
PUT    /teams/:id/members/:memberId     # Обновить роль участника
DELETE /teams/:id/members/:memberId     # Удалить участника

GET    /teams/:id/invitations           # Получить приглашения
POST   /teams/invitations/:token/accept # Принять приглашение
POST   /teams/invitations/:token/decline # Отклонить приглашение
DELETE /teams/:id/invitations/:inviteId # Отозвать приглашение

GET    /teams/:id/projects              # Получить проекты команды
POST   /teams/:id/projects/:projectId/members # Добавить участника в проект
DELETE /teams/:id/projects/:projectId/members/:userId # Удалить из проекта
PUT    /teams/:id/projects/:projectId   # Обновить уровень доступа
```

## Принципы дизайна

### SOLID

- **S** - Каждый класс и модуль имеет одну ответственность
- **O** - Система открыта для расширения (новые роли, права)
- **L** - Наследование ролей и интерфейсов
- **I** - Разделение интерфейсов для API, Store, UI
- **D** - Зависимость от абстракций, а не конкретных реализаций

### DRY

- Переиспользование утилит для работы с ролями
- Общие типы для API и UI
- Единый подход к обработке ошибок

### KISS

- Простая и понятная структура ролей
- Минимальное количество уровней доступа
- Четкое разделение ответственности

## Безопасность

- Валидация прав доступа на фронтенде и бэкенде
- Проверка токенов приглашений
- Контроль сроков действия приглашений
- Аудит действий пользователей

## Расширение системы

Система готова к расширению:

1. **Новые роли** - добавление в enum и функции прав
2. **Дополнительные права** - расширение RolePermissions
3. **Уведомления** - интеграция с системой уведомлений
4. **Аналитика** - добавление метрик и отчетов
5. **Интеграции** - подключение внешних сервисов

## Тестирование

Рекомендуется добавить тесты для:

- Утилит работы с ролями
- API endpoints
- Компонентов UI
- Store логики
- Валидации форм 